#!/bin/bash

# Hide all output and background job notifications
exec >/dev/null 2>&1

# Function for silent spinner
spinner() {
    local pid=$1
    local delay=0.1
    local spinstr='|/-\'
    while kill -0 $pid 2>/dev/null; do
        local temp=${spinstr#?}
        printf " [%c] " "$spinstr"
        local spinstr=$temp${spinstr%"$temp"}
        sleep $delay
        printf "\b\b\b\b\b"
    done
    printf "    \b\b\b\b"
}

clear
# Enable output temporarily for messages
exec >/dev/tty 2>&1
echo -e "\033[1;34m=====================================\033[0m"
echo -e "\033[1;34m         FNAI LINUX INSTALLER         \033[0m"
echo -e "\033[1;34m=====================================\033[0m"
exec >/dev/null 2>&1

# Update packages
exec >/dev/tty 2>&1
echo -e "\n\033[1;37m[FNAI] MENGUPDATE PACKAGE\033[0m"
exec >/dev/null 2>&1
sudo apt update -y
sudo apt upgrade -y
exec >/dev/tty 2>&1
echo -e "\033[1;36m✓ Update package selesai\033[0m"

# Install Python
exec >/dev/tty 2>&1
echo -e "\n\033[1;37m[FNAI] MENGINSTALL PYTHON3 DAN PIP3\033[0m"
exec >/dev/null 2>&1
sudo apt install -y python3 python3-pip
exec >/dev/tty 2>&1
echo -e "\033[1;36m✓ Python3 dan pip3 terinstall\033[0m"

# Install Dependencies
exec >/dev/tty 2>&1
echo -e "\n\033[1;37m[FNAI] MENGINSTALL DEPENDENSI\033[0m"
exec >/dev/null 2>&1
pip3 install base64 google-generativeai
exec >/dev/tty 2>&1
echo -e "\033[1;36m✓ Dependensi Python terinstall\033[0m"

# Install FNAI
exec >/dev/tty 2>&1
echo -e "\n\033[1;37m[FNAI] MENGINSTALL FNAI\033[0m"
exec >/dev/null 2>&1
git clone https://github.com/f0oln3t/fnai.git &
spinner $!
wait
cd fnai
exec >/dev/tty 2>&1
echo -e "\033[1;36m✓ FNAI berhasil diinstall\033[0m"

# Final message
exec >/dev/tty 2>&1
echo -e "\n\033[1;34m=====================================\033[0m"
echo -e "\033[1;36m[FNAI] SUKSES SEMUA SUDAH TERINSTALL\033[0m"
echo -e "\033[1;37mGunakan perintah berikut untuk menjalankan:\033[0m"
echo -e "\033[1;37mcd fnai && python3 fnai.py\033[0m"
echo -e "\033[1;34m=====================================\033[0m"
